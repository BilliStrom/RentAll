<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentAll - Главная</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav>
            <h1>RentAll</h1>
            <ul class="nav-links">
                <li><a href="index.html">Главная</a></li>
                <li><a href="dashboard.html">Личный кабинет</a></li>
                <li><a href="login.html">Войти</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="items-grid">
            <!-- Карточки товаров будут загружены через JavaScript -->
        </section>
    </main>

    <!-- Подключение Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js"></script>
    <script src="firebase.js"></script>
    <script>
        // Загрузка данных из Firestore
        const loadItems = async () => {
            const itemsGrid = document.querySelector('.items-grid');
            console.log('Загрузка данных...'); // Отладка
            try {
                const querySnapshot = await db.collection('items').get();
                console.log('Документы:', querySnapshot.docs); // Отладка
                itemsGrid.innerHTML = ''; // Очищаем контейнер перед загрузкой
                querySnapshot.forEach(doc => {
                    const item = doc.data();
                    console.log('Товар:', item); // Отладка
                    itemsGrid.innerHTML += `
                        <article class="item-card">
                            <img src="${item.image}" alt="${item.title}" class="item-image">
                            <div class="item-info">
                                <h3>${item.title}</h3>
                                <p class="price">${item.price} руб/день</p>
                                <p>${item.description}</p>
                                <button class="btn btn-primary" onclick="rentItem('${doc.id}')">Арендовать</button>
                            </div>
                        </article>
                    `;
                });
            } catch (error) {
                console.error('Ошибка загрузки данных:', error); // Отладка
            }
        };

        // Загрузка данных при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Страница загружена'); // Отладка
            loadItems();
        });

        // Функция аренды товара
        window.rentItem = async (itemId) => {
            if (!auth.currentUser) {
                alert('Пожалуйста, войдите в систему, чтобы арендовать товар.');
                window.location.href = 'login.html';
                return;
            }
            try {
                await db.collection('bookings').add({
                    userId: auth.currentUser.uid,
                    itemId: itemId,
                    date: new Date().toISOString(),
                });
                alert('Товар успешно арендован!');
            } catch (error) {
                alert('Ошибка: ' + error.message);
            }
        };
    </script>
</body>
</html>
